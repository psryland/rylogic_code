<Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<PropertyGroup>
		<PythonExe>$(WinDir)\py.exe</PythonExe>
		<HtmlExpandScript>D:\Dump\pr\script\HtmlExpand.py</HtmlExpandScript>
	</PropertyGroup>

	<!-- Add Build Action options -->
	<ItemGroup>
		<AvailableItemName Include="HtmlExpandContent" />
		<AvailableItemName Include="HtmlExpandResource" />
	</ItemGroup>

	<!-- Target for building content resource html templates -->
	<Target Name="HtmlExpandContentTarget"
			Inputs = "@(HtmlExpandContent)"
			Outputs = "@(HtmlExpandContent -> '%(directory)%(filename).html')"
			BeforeTargets="BeforeResGen"
			Condition="'@(HtmlExpandContent)' != ''">
		
		<Exec
			Command="$(PythonExe) $(HtmlExpandScript) %22%(HtmlExpandContent.Fullpath)%22"
			ContinueOnError="ErrorAndContinue"/>
		<ItemGroup>
			<Content Include="%(HtmlExpandContent.RootDir)%(HtmlExpandContent.Directory)%(HtmlExpandContent.Filename).html">
				<DependentUpon>%(HtmlExpandContent.Fullpath)</DependentUpon>
				<CopyToOutputDirectory>Always</CopyToOutputDirectory>
			</Content>
		</ItemGroup>
	</Target>

	<!-- Target for building embedded resource html templates -->
	<Target Name="HtmlExpandResourceTarget"
			Inputs = "@(HtmlExpandResource)"
			Outputs = "@(HtmlExpandResource -> '%(directory)%(filename).html')"
			BeforeTargets="BeforeResGen"
			Condition="'@(HtmlExpandResource)' != ''">

		<Exec
			Command="$(PythonExe) $(HtmlExpandScript) %22%(HtmlExpandResource.Fullpath)%22"
			ContinueOnError="ErrorAndContinue"/>

			<ItemGroup>
			<None Include="%(HtmlExpandResource.RootDir)%(HtmlExpandResource.Directory)%(HtmlExpandResource.Filename).html">
				<DependentUpon>%(HtmlExpandResource.Fullpath)</DependentUpon>
			</None>
		</ItemGroup>
	</Target>
	
</Project>